groups:
  - name: p2_rules
    rules:

    - alert: P2Down
      expr: up{job="project2"} == 0
      for: 16h
      labels:
        severity: page

    - alert: AppStartTime
      expr: application_started_time_seconds{job="project2"} > 25
      labels:
        severity: ticket

    - alert: GetItemsRequestLatency
      expr: getallitems_time_seconds_max{job="project2"} >= 0.5
      for:
      labels:
        severity: ticket

    - alert: GetUsersRequestLatency
      expr: getallusers_time_seconds_max{job="project2"} >= 0.5
      labels:
        severity: ticket

    - alert: AddItemRequestLatency
      expr: additem_time_seconds_max{job="project2"} >= 0.5
      labels:
        severity: ticket

    - alert: RegisterRequestLatency
      expr: register_time_seconds_max{job="project2"} >= 0.5
      labels:
        severity: ticket

    - alert: DeleteItemRequestLatency
      expr: deleteitem_time_seconds_max{job="project2"} >= 0.5
      labels:
        severity: ticket

    - alert: DeleteUserRequestLatency
      expr: deleteuser_time_seconds_max{job="project2"} >= 0.5
      labels:
        severity: ticket

    - alert: LoginFailures
      expr: ((login_fail_counter_total / ignoring(class,exception,instance,job,method,result) sum(login_time_seconds_count)) >= bool 0.1) == 1
      labels:
        severity: ticket

#counts how many instances have restarted more than 4 times in the past hour
#alert if more than 5% of instances in the job are in this state
    - alert: AppTooManyRestarts
      expr: avg without (instance) (changes(process_start_time_seconds[1h]) > bool 4) >= .05
      for: 10m
      labels:
        severity: ticket